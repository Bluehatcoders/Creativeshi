var smokemachine=function(t,a){function i(a,i,e){this.x=a,this.y=i,this.age=0,this.vx=(8*Math.random()-4)/100,this.startvy=-(30*Math.random()+10)/100,this.vy=this.startvy,this.scale=.5*Math.random(),this.lifetime=Math.random()*e+e/2,this.finalscale=5+this.scale+Math.random(),this.update=function(t){this.x+=this.vx*t,this.y+=this.vy*t;var a=Math.pow(this.age/this.lifetime,.5);this.vy=(1-a)*this.startvy,this.age+=t,this.scale=a*this.finalscale},this.draw=function(){t.globalAlpha=(1-Math.abs(1-2*this.age/this.lifetime))/8;var a=this.scale*p/2,i=this.x-a,e=i+this.scale*y,s=this.y-a,n=s+this.scale*y;t.drawImage(d,i,s,e-i,n-s)}}function e(t,a,e,s){if(s=s||4e3,e=e||10,e<1)return Math.random()<=e&&u.push(new i(t,a,s));for(var n=0;n<e;n++)u.push(new i(t,a,s))}function s(a){t.clearRect(0,0,t.canvas.width,t.canvas.height),a=a||16;var i=[];m=m.concat(u),u=[],m.forEach(function(t){t.update(a),t.age<t.lifetime&&(t.draw(),i.push(t))}),m=i}function n(t){if(M){var a=t-r;r=t,s(a),c(n)}}function h(){M=!0,c(function(t){r=t,c(n)})}function o(){M=!1}a=a||[24,46.8,48.2];var r,c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,m=[],u=[],d=document.createElement("canvas"),f=d.getContext("2d");d.width=20,d.height=20;for(var l=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,5,5,7,4,4,1,1,0,1,0,0,0,0,0,1,0,0,17,27,41,52,56,34,23,15,11,4,9,5,1,0,0,0,0,0,0,1,45,63,57,45,78,66,52,41,34,37,23,20,0,1,0,0,0,0,1,43,62,66,64,67,115,112,114,56,58,47,33,18,12,10,0,0,0,0,39,50,63,76,87,107,105,112,128,104,69,64,29,18,21,15,0,0,0,7,42,52,85,91,103,126,153,128,124,82,57,52,52,24,1,0,0,0,2,17,41,67,84,100,122,136,159,127,78,69,60,50,47,25,7,1,0,0,0,34,33,66,82,113,138,149,168,175,82,142,133,70,62,41,25,6,0,0,0,18,39,55,113,111,137,141,139,141,128,102,130,90,96,65,37,0,0,0,2,15,27,71,104,129,129,158,140,154,146,150,131,92,100,67,26,3,0,0,0,0,46,73,104,124,145,135,122,107,120,122,101,98,96,35,38,7,2,0,0,0,50,58,91,124,127,139,118,121,177,156,88,90,88,28,43,3,0,0,0,0,30,62,68,91,83,117,89,139,139,99,105,77,32,1,1,0,0,0,0,0,16,21,8,45,101,125,118,87,110,86,64,39,0,0,0,0,0,0,0,0,0,1,28,79,79,117,122,88,84,54,46,11,0,0,0,0,0,0,0,0,0,1,0,6,55,61,68,71,30,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,23,25,20,12,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,12,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0],v=f.createImageData(20,20),w=v.data,g=0;g<w.length;g+=4)w[g]=a[0],w[g+1]=a[1],w[g+2]=a[2],w[g+3]=l[g/4];f.putImageData(v,0,0);var p=100,y=100,M=!1;return{start:h,stop:o,step:s,addsmoke:e}};